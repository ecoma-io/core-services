networks:
  default:
    external:
      name: dev-infras

volumes:
  postgres_data:

services:
  postgres:
    build: .
    container_name: postgres
    restart: unless-stopped
    ports:
      - '${POSTGRES_PORT}:5432' # Expose PostgreSQL port for external access
    environment:
      POSTGRES_USER: ${POSTGRES_USERNAME} # Database username from env var
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD} # Database password from env var
      POSTGRES_DATABASES: ${POSTGRES_DATABASES} # Database name from env var (standardized to singular)
    volumes:
      - postgres_data:/var/lib/postgresql/data # Persistent data volume
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U $$POSTGRES_USER || exit 1']
      interval: 30s
      timeout: 5s
      retries: 30
